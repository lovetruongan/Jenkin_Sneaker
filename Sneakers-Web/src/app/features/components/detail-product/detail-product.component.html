@if (mainProduct && (roleId == 1 || !roleId)){
  <div class="container detail">
    <div class="intro-section">
      <h4><span class="text-secondary">Giày | Basas | </span>{{mainProduct.name}}</h4>
      <div style="width: 100%; height: 2.5px; background-color: black;"></div>
    </div>
    <div class="row detail-shoe" style="margin-left: 20px;">
      <div class="col-md-6">
        <!-- main image -->
        <div id="carouselExample" class="carousel slide" data-bs-ride="carousel" style="margin-left: -20px;">
          <p-galleria [value]="images" [numVisible]="5" [circular]="true" [showItemNavigators]="true"
            [responsiveOptions]="responsiveOptions" [containerStyle]="{ 'max-width': '640px' }">
            <ng-template pTemplate="item" let-item>
              <img [src]="apiImage + item.image_url"
                style="width: 100%; display: block;" />
            </ng-template>
            <ng-template pTemplate="thumbnail" let-item>
              <div class="grid grid-nogutter justify-content-center">
                <img [src]="apiImage + item.image_url"
                  style="display: block; width: 80%" />
              </div>
            </ng-template>
          </p-galleria>
        </div>
      </div>
  
      <!-- details -->
      <div class="col-md-6 details">
        <div class="mt-4 mb-3 position-relative">
          <h2 class="text-uppercase fw-bold my-4">{{mainProduct.name}}</h2>
          <p class="my-4">Mã sản phẩm: <span class="text-dark fw-bold">{{mainProduct.id}}</span></p>
          <p class="my-4 position-absolute" style="top:27%; left: 60%">Tình trạng:
            <span class="text-dark fw-bold">{{mainProduct.quantity > 0 ? 'Còn hàng' : 'Hết hàng'}}</span>
          </p>
          <div class="d-flex price-wrapper">
            <h2 class="text-danger my-4">{{mainProduct.price | currency:'VND':'symbol':'1.0-0'}}</h2>
            @if(mainProduct.discount){
              <h2 class="my-4 old-price">{{mainProduct.price / (1-mainProduct.discount/100) | currency:'VND':'symbol':'1.0-0'}}</h2>
            }
          </div>
        </div>
        <hr>
  
        <h2 class="my-4">Thông tin chi tiết sản phẩm</h2>
        <p class="about mb-4" style="font-size: 16px;">{{mainProduct.description}}</p>
  
        <hr>
  
        <div class="sizes mt-4">
          <h6 class="text-uppercase" style="margin-left: 10px;">Size</h6>
          @for (item of sizes; track item) {
          <label class="radio">
            <input type="radio" name="size" [value]="item" [(ngModel)]="size" checked>
            <span>{{item}}</span>
          </label>
          }
        </div>
  
        <hr>
  
        <div class="product-details">
          <h5>Số lượng</h5>
          <div class="product-quantity">
            <div class="border-wrapper">
              <p-inputNumber [min]="1" [(ngModel)]="quantity" buttonLayout="horizontal" inputId="horizontal"
                [showButtons]="true" decrementButtonClass="p-button-secondary" incrementButtonClass="p-button-secondary"
                incrementButtonIcon="pi pi-plus" decrementButtonIcon="pi pi-minus"></p-inputNumber>
            </div>
          </div>
          <div class="product-actions">
            <p-toast></p-toast>
            <button (click)="addToCart()" class="btn btn-dark" style="font-size: 18px;" [disabled]="mainProduct.quantity === 0">Thêm vào giỏ hàng</button>
            <button class="btn btn-danger" style="font-size: 18px;" [disabled]="mainProduct.quantity === 0">Mua ngay</button>
            <i class="pi pi-heart" title="Thêm vào yêu thích"></i>
          </div>
        </div>
      </div>
    </div>
  
    <hr class="mt-5">
    <!-- suggestion -->
    <div class="suggest my-5 d-none d-md-block">
      <h3 class="text-center text-uppercase fw-bold">Sản phẩm liên quan</h3>
  
      <div class="container-lg">
        <div class="row my-4 align-items-center justify-content-center g-5">
          @for(product of relatedProducts; track product){
            <div (click)="goToDetail(product.id)" class="col-8 col-lg-3">
              <div class="card border-0">
                <div class="card-body py-3">
                  <img [src]="apiImage + product.thumbnail" alt="giaycv" class="img-fluid">
                </div>
                <div class="card-footer text-center tw-bold border-0">
                  <p class="lead card-title text-secondary">{{product.name}}</p>
                  <p class="my-2 text-danger fw-semibold" style="font-size: 15px;">{{product.price | currency:'VND':'symbol':'1.0-0'}}</p>
                </div>
              </div>
            </div>
          }
  
        </div>
      </div>
    </div>
  </div>
  } 
  @else if (mainProduct && roleId == 2) {
    <div class="admin-edit-container">
      <p-toast></p-toast>
      <p-confirmDialog></p-confirmDialog>

      <div class="admin-header">
        <h2>Chỉnh sửa sản phẩm</h2>
        <div class="header-actions">
          <button pButton pRipple 
                  type="button" 
                  label="Quay lại" 
                  icon="pi pi-arrow-left"
                  class="p-button-outlined"
                  (click)="goBack()">
          </button>
        </div>
      </div>

      <div class="admin-content">
        <!-- Left Column - Product Images -->
        <div class="admin-images-column">
          <p-card styleClass="images-card">
            <ng-template pTemplate="header">
              <h3>Ảnh sản phẩm hiện tại</h3>
            </ng-template>
            
            <div class="current-product-gallery" *ngIf="images && images.length > 0">
              <p-galleria [value]="images" 
                          [numVisible]="4" 
                          [circular]="true" 
                          [showItemNavigators]="true"
                          [showThumbnails]="true"
                          [responsiveOptions]="responsiveOptions" 
                          [containerStyle]="{ 'max-width': '100%' }">
                <ng-template pTemplate="item" let-item>
                  <img [src]="apiImage + item.image_url" 
                       style="width: 100%; max-height: 400px; object-fit: contain;" 
                       alt="Product image" />
                </ng-template>
                <ng-template pTemplate="thumbnail" let-item>
                  <div class="grid grid-nogutter justify-content-center">
                    <img [src]="apiImage + item.image_url" 
                         style="width: 80%; object-fit: cover;" 
                         alt="Thumbnail" />
                  </div>
                </ng-template>
              </p-galleria>
            </div>

            <div class="current-images-grid" *ngIf="images && images.length > 0">
              <h4>Tất cả ảnh ({{ images.length }})</h4>
              <div class="images-grid">
                <div *ngFor="let image of images; trackBy: trackByImageId" class="image-item">
                  <img [src]="apiImage + image.image_url" alt="Product image" class="image-preview">
                  <div class="image-info">
                    <span class="image-id">ID: {{ image.id }}</span>
                    <button pButton 
                            pRipple 
                            type="button" 
                            icon="pi pi-trash"
                            class="p-button-rounded p-button-text p-button-danger p-button-sm"
                            pTooltip="Xóa ảnh này" 
                            (click)="deleteImage(image.id)">
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <div class="empty-images" *ngIf="!images || images.length === 0">
              <i class="pi pi-image" style="font-size: 3rem; color: #ccc;"></i>
              <p>Sản phẩm chưa có ảnh</p>
            </div>
          </p-card>
        </div>

        <!-- Right Column - Edit Form -->
        <div class="admin-form-column">
          <p-card styleClass="edit-form-card">
            <ng-template pTemplate="header">
              <h3>Thông tin sản phẩm</h3>
            </ng-template>

            <div class="edit-form">
              <form class="p-fluid" [formGroup]="productForm">
                <div class="grid">
                  <div class="col-12 md:col-6">
                    <div class="field">
                      <label for="productName">Tên sản phẩm</label>
                      <input id="productName" 
                             type="text" 
                             pInputText 
                             formControlName="productName"
                             placeholder="Nhập tên sản phẩm"/>
                    </div>
                  </div>
                  <div class="col-12 md:col-6">
                    <div class="field">
                      <label for="category">Danh mục</label>
                      <p-dropdown id="category"
                                  [options]="categoriesOptions" 
                                  [placeholder]="categoryNameOfProduct"
                                  optionLabel="label"
                                  optionValue="value"
                                  (onChange)="onCategoryChange($event)">
                      </p-dropdown>
                    </div>
                  </div>
                </div>

                <div class="grid">
                  <div class="col-12 md:col-4">
                    <div class="field">
                      <label for="price">Giá (VNĐ)</label>
                      <p-inputNumber id="price" 
                                     formControlName="price"
                                     mode="currency"
                                     currency="VND"
                                     locale="vi-VN"
                                     placeholder="0">
                      </p-inputNumber>
                    </div>
                  </div>
                  <div class="col-12 md:col-4">
                    <div class="field">
                      <label for="discount">Giảm giá (%)</label>
                      <p-inputNumber id="discount" 
                                     formControlName="discount"
                                     [min]="0"
                                     [max]="100"
                                     placeholder="0">
                      </p-inputNumber>
                    </div>
                  </div>
                  <div class="col-12 md:col-4">
                    <div class="field">
                      <label for="quantity">Số lượng</label>
                      <p-inputNumber id="quantity" 
                                     formControlName="quantity"
                                     [min]="0"
                                     placeholder="0">
                      </p-inputNumber>
                    </div>
                  </div>
                </div>

                <div class="field">
                  <label for="description">Mô tả sản phẩm</label>
                  <textarea id="description" 
                            rows="4" 
                            pInputTextarea 
                            formControlName="description"
                            placeholder="Nhập mô tả chi tiết về sản phẩm...">
                  </textarea>
                </div>

                <div class="field">
                  <label>Thêm ảnh mới</label>
                  <div class="upload-section">
                    <p-fileUpload mode="basic" 
                                  [auto]="false" 
                                  [multiple]="true" 
                                  chooseLabel="Chọn ảnh mới" 
                                  name="myFile[]" 
                                  accept="image/*" 
                                  (onSelect)="onFileSelect($event)"
                                  class="upload-btn">
                    </p-fileUpload>
                    <small class="upload-hint">Chọn ảnh mới để thêm vào sản phẩm. Định dạng: JPG, PNG, GIF</small>
                  </div>
                </div>

                <div class="field" *ngIf="myFiles && myFiles.length > 0">
                  <label>Ảnh mới sẽ thêm ({{ myFiles.length }})</label>
                  <div class="new-files-preview">
                    <div *ngFor="let file of myFiles; let i = index" class="new-file-item">
                      <div class="file-preview">
                        <img [src]="getFilePreview(file)" alt="New image" class="preview-image">
                      </div>
                      <div class="file-info">
                        <span class="file-name">{{ file.name }}</span>
                        <span class="file-size">{{ (file.size / 1024).toFixed(0) }}KB</span>
                        <button pButton 
                                pRipple 
                                type="button" 
                                icon="pi pi-times"
                                class="p-button-rounded p-button-text p-button-danger p-button-sm"
                                (click)="removeFile(i)">
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </form>
            </div>

            <ng-template pTemplate="footer">
              <div class="form-actions">
                <button pButton pRipple 
                        type="button" 
                        label="Xóa sản phẩm" 
                        icon="pi pi-trash" 
                        class="p-button-danger p-button-outlined"
                        (click)="confirmDelete()">
                </button>
                <button pButton pRipple 
                        type="button" 
                        label="Cập nhật sản phẩm" 
                        icon="pi pi-check" 
                        class="p-button-raised"
                        (click)="updateProductAdmin()"
                        [disabled]="!productForm.valid">
                </button>
              </div>
            </ng-template>
          </p-card>
        </div>
      </div>
    </div>
  }
  @else if (mainProduct && roleId == 100) {}